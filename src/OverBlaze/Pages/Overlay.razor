@page "/Overlay"
@using OverBlaze.Services
@using System.Threading
@using System.Collections.ObjectModel
@layout EmptyLayout
@inject ControlBus ControlBus

@foreach (var image in _images)
{
<img src="/images/@image.Path.TrimStart('/')" style="@image.Style" />
}

@code {

  List<ToggleImage> _images = new();

  protected override Task OnInitializedAsync()
  {
    ControlBus.DisplayImage += ToggleImage;
    return Task.CompletedTask;
  }

  private async Task ToggleImage(ToggleImage image)
  {
    var existing = _images.FirstOrDefault(i => i.Path == image.Path);
    if (existing is not null)
    {
      _images.Remove(existing);
    }
    else
    {
      _images.Add(image);
    }
    await InvokeAsync(StateHasChanged);
  }

}